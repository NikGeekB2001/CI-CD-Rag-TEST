# AI-Медицинский Ассистент с RAG

Этот проект представляет собой продвинутого медицинского ассистента, интегрирующего технологии Retrieval-Augmented Generation (RAG), Named Entity Recognition (NER) и шаблонные ответы для предоставления безопасных и точных медицинских рекомендаций.

## Особенности

- **RAG-конвейер**: Интеллектуальный поиск релевантной медицинской информации в векторной базе данных Milvus с использованием эмбеддингов
- **NER-анализ**: Распознавание медицинских сущностей с помощью адаптера LoRA для точного анализа симптомов и состояний
- **Шаблонные ответы**: Структурированные, безопасные рекомендации с учетом типа вопроса (температура, боль, раны и т.д.)
- **Модульная архитектура**: Легко тестируемый и расширяемый код с разделением на компоненты
- **Генеративные ответы**: Использование больших языковых моделей для создания персонализированных ответов

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd ci-cd-rag-test
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Запустите проект с помощью Docker:
   ```bash
   docker-compose up --build
   ```

## Запуск

После установки запустите приложение:

```bash
docker-compose up --build
```

Приложение будет доступно по адресу: http://localhost:8501

## Структура проекта

```
├── src/                    # Исходный код
│   ├── rag_pipeline.py     # Логика RAG-поиска в Milvus
│   ├── medical_assistant.py # Основной класс ассистента с моделями
│   ├── app.py             # Streamlit веб-интерфейс
│   └── init_milvus.py     # Инициализация базы данных Milvus
├── tests/                 # Тесты
│   ├── conftest.py        # Фикстуры для тестов
│   ├── test_assistant.py  # Тесты ассистента
│   └── test_rag_pipeline.py # Тесты RAG-конвейера
├── data/                  # Медицинские данные
│   └── medical_data.json  # База знаний медицинских вопросов
├── models/                # Модели и адаптеры
├── evaluation/            # Оценка качества RAG
├── .github/workflows/     # CI/CD пайплайны
└── requirements.txt       # Зависимости Python
```

## Тестирование

Для запуска тестов выполните следующие команды:

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск всех тестов с подробным выводом
pytest tests/ -v --cov=. --cov-report=html

# Запуск тестов с покрытием кода
pytest tests/ --cov=. --cov-report=term-missing
```

### Виды тестов:
- **Тестирование типов вопросов**: Проверка определения типа вопроса (приветствие, температура, боль и т.д.)
- **Тестирование генерации ответов**: Проверка создания шаблонных и генеративных ответов
- **Тестирование RAG-конвейера**: Проверка поиска в векторной базе данных

### Результаты тестирования:
-  RAG-конвейер поиска работает корректно
- Тесты ассистента требуют настройки фикстур для загрузки моделей

## CI/CD

Проект использует GitHub Actions для автоматического тестирования и развертывания:

- **Автоматическое тестирование**: Запуск тестов при каждом push и pull request
- **Кэширование моделей**: Оптимизация загрузки моделей Hugging Face
- **Отчеты о покрытии**: Генерация HTML-отчетов о покрытии кода

## Разработка и внесение изменений

### Локальная разработка

1. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Запустите тесты локально:
   ```bash
   pytest tests/ -v
   ```

### Внесение изменений и push в репозиторий

1. Проверьте статус репозитория:
   ```bash
   git status
   ```

2. Добавьте измененные файлы:
   ```bash
   git add .
   git add tests/conftest.py
   ```

3. Создайте коммит с описательным сообщением:
   ```bash
   git commit -m "Описание изменений"
   git commit -m "Rag milvus CI CD"
   ```

4. Отправьте изменения в удаленный репозиторий:
   ```bash
   git push origin main
         ```

5. После push CI/CD pipeline автоматически запустит тесты и проверит код.

### CI/CD pipeline
 git add . && git commit -m "Increase disk space cleanup in CI/CD to fix container startup failures" && git push

### Рабочий процесс Git

- **main** — основная ветка для стабильного кода
- Все изменения вносятся через pull requests для ревью
- CI/CD проверяет каждый push и PR

## Используемые технологии

- **Python 3.11**: Основной язык программирования
- **Streamlit**: Веб-интерфейс
- **Milvus**: Векторная база данных
- **Transformers**: Модели Hugging Face
- **Sentence Transformers**: Генерация эмбеддингов
- **PyTorch**: Фреймворк для ML
- **Docker**: Контейнеризация

## Безопасность и ограничения

 **Важно**: Этот ассистент предназначен только для информационных целей и не заменяет консультацию квалифицированного врача. Всегда обращайтесь к медицинским специалистам для точной диагностики и лечения.
